<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.devking2106.useddeal.repository.mapper.UserMapper">

    <resultMap id="UserDetailDto" type="me.devking2106.useddeal.dto.UserDetailDto">
        <result property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="nickname" column="nickname"/>
        <result property="locationName" column="location_name"/>
        <result property="regDate" column="reg_date"/>
        <result property="saleCount" column="sale_count"/>
        <result property="authCount" column="auth_count"/>
    </resultMap>

    <insert id="save" parameterType="me.devking2106.useddeal.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO USER
        SET USER_ID = #{userId},
            LOCATION_NAME = #{locationName},
            LOCATION_ID = #{locationId},
            PASSWORD = #{password},
            NICKNAME = #{nickname},
            PHONE = #{phone},
            EMAIL = #{email},
            REG_DATE = #{regDate},
            MOD_DATE = #{modDate},
            LOGIN_DATE = #{loginDate},
            ROLE = #{role},
            STATUS = #{status},
            SALE_COUNT = #{saleCount},
            IMAGE_PATH = #{imagePath},
            LATITUDE = #{latitude},
            LONGITUDE = #{longitude},
            AUTH_COUNT = #{authCount}
    </insert>

    <select id="findById" resultType="me.devking2106.useddeal.entity.User">
        SELECT *
        FROM USER
        WHERE id = #{id}
          AND status != 'DELETED'
    </select>

    <select id="idCheck" resultType="boolean">
        SELECT COUNT(USER_ID)
        FROM USER
        WHERE USER_ID = #{userId}
    </select>

    <select id="findByNickName" resultType="me.devking2106.useddeal.dto.UserFindDto">
        SELECT ID,
               NICKNAME,
               LOCATION_NAME
        FROM USER
        WHERE NICKNAME LIKE '%${nickname}%'
          AND status != 'DELETED'
    </select>

    <select id="findByIdAndPassword" resultType="me.devking2106.useddeal.entity.User">
        SELECT *
        FROM USER
        WHERE USER_ID = #{id}
        AND PASSWORD = #{password}
        AND STATUS != 'DELETED'
    </select>

</mapper>
